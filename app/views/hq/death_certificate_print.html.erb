<!DOCTYPE HTML>
<html>
<head>
  <title>eDRS Death Certificate</title>
  <style>
 @media all {  
 body {
          margin: 0;
          -moz-user-select: none;
          font-family: "Nimbus Sans L", "Arial Narrow", sans-serif;
          margin-left: 10px;
          margin-right: 10px;
          color: #000;
          font-size: 20px;
      }
      
      #barcode {
        margin-right: 30px;
        padding-top: 0px;
        margin-top: 30px;
        float: right;
      }
      
      #childdata {
       clear: both;
       width: 21cm;
       margin-top: 40cm;
       padding-top: 8cm;
       margin-left: auto;
       margin-right: auto;
      
      }
      
      #childdata #birthoath 
      {
        text-align: center;
        
      }
      
      #childdata #signature 
      {
        text-align: left;
        float: right;
        
      }}
   
  </style>
</head>
<body style="color: #000;">
 
  <div id="barcode">
   <% raw = File.read("#{CONFIG['barcodes_path']}#{@person.id}.png")

       @data = Base64.encode64(raw)

    %>
    <img src ="data:image/png;base64,<%= @data%>" />
    <br/>
    <div style="text-align: center !important;margin-top: -15px;font-size: 12px;"><%= @person.npid %></div>
  </div>

<div id="childdata">

<table style="width: 21cm; font-weight: normal;" cellpadding="8" width="100%">
      <tr>
          <td style="width: 130px;" align="right">
            1.
          </td>
          <td align="left" style="width: 250px;">
            Death Entry Number
          </td>
          <td align="left">
            <%= @den %>
          </td>
        </tr>
        <tr>
          <td style="width: 130px;" align="right">
            2.
          </td>
          <td align="left" style="width: 250px;">
            Registration Number
          </td>
          <td align="left">
            <%= @drn  %>
          </td>
        </tr
        <tr>
          <td style="width: 130px;" align="right">
            3.
          </td>
          <td align="left" style="width: 250px;">
            Name of Deceased
          </td>
          <td align="left">
            <%= @person[:first_name] %> <%= @person[:middle_name] %> <%= @person[:last_name] %>
          </td>
        </tr>
        <tr>
          <td style="width: 130px;" align="right">
            4.
          </td>
          <td align="left" style="width: 250px;">
            Date of Birth
          </td>
          <td align="left">
            <%= (!@person[:birthdate].blank? ? @person[:birthdate].to_date.day : "") %><sup
            style="font-size: 18px;"><%= (!@person[:birthdate].blank? ?
                  @person[:birthdate].to_date.day.ordinalize.match(/([a-z]+)/).captures.first : "") %></sup>
            <%= (!@person[:birthdate].blank? ? @person[:birthdate].to_date.strftime("%B, %Y") : "") %>
          </td>
        </tr>
        <tr>
          <td style="width: 130px;" align="right">
            5.
          </td>
          <td align="left" style="width: 250px;">
            Sex
          </td>
          <td align="left">
            <%= @person[:gender] %>
          </td>
        </tr>
        <tr>
          <td style="width: 130px;" align="right">
            6.
          </td>
          <td align="left" style="width: 250px;">
            Date of Death
          </td>
          <td align="left">
            <%= (!@person[:date_of_death].blank? ? @person[:date_of_death].to_date.day : "") %><sup
            style="font-size: 18px;"><%= (!@person[:date_of_death].blank? ?
                  @person[:date_of_death].to_date.day.ordinalize.match(/([a-z]+)/).captures.first : "") %></sup>
            <%= (!@person[:date_of_death].blank? ? @person[:date_of_death].to_date.strftime("%B, %Y") : "") %>
          </td>
        </tr>
        <tr>
          <td style="width: 130px;" align="right">
            7.
          </td>
          <td align="left" style="width: 250px;">
            Place of Death
          </td>
          <td align="left">
           <%
                place_of_death = ""

               case @person["place_of_death"]
                 when "Home(Place of residence)"
                    place_of_death = "#{@person.place_of_death_village}#{(!@person.place_of_death_village.blank? ?
                            ", " : "")}#{@person.place_of_death_ta}#{(!@person.place_of_death_ta.blank? ?
                            ", " : "")}#{@person.place_of_death_district}"

                 when "Hospital/Institution"

                    place_of_death = "#{@person.hospital_of_death}"

                 when "Other"
                    place_of_death = "#{@person.other_place_of_death} " + @person.place_of_death_district

                 end
            %>
            <%= place_of_death %>
          </td>
        </tr>
        <tr>
          <td style="width: 130px;" align="right">
            8.
          </td>
          <td align="left" style="width: 250px;">
            Name of Mother
          </td>
          <td align="left">
            <%= @person[:mother_first_name] %> <%= @person[:mother_middle_name] %> <%= @person[:mother_last_name] %>
          </td>
        </tr>
        <tr>
          <td style="width: 130px;" align="right">
            9.
          </td>
          <td align="left" style="width: 250px;">
            Name of Father
          </td>
          <td align="left">
            <%= @person[:father_first_name] %> <%= @person[:father_middle_name] %> <%= @person[:father_last_name] %>
          </td>
        </tr>
        <tr>
          <td style="width: 130px;" align="right">
            10.
          </td>
          <td align="left" style="width: 250px;">
            Date of Registration
          </td>
          <td align="left">
            <%= (!@person[:created_at].blank? ? @person[:created_at].to_date.day : "") %><sup
            style="font-size: 18px;"><%= (!@person[:created_at].blank? ?
                  @person[:created_at].to_date.day.ordinalize.match(/([a-z]+)/).captures.first : "") %></sup>
            <%= (!@person[:created_at].blank? ? @person[:created_at].to_date.strftime("%B, %Y") : "") %>
          </td>
        </tr>
          
          <tr><td colspan="3" align="center" valign="middle">
              <p style="font-size: 18px; font-weight: normal;"><br>I hereby certify the above to be a true and correct extract from the<br/>
          Death Register kept at NRB.<br/><br/>
          
          Dated this <%= Date.today.strftime("%d").to_i rescue nil %><sup><%= Date.today.strftime("%d").to_i.ordinalize.gsub(/\d+/, "") rescue nil %></sup> 
          <%= Date.today.strftime("%B") rescue nil %>, <%= Date.today.strftime("%Y") rescue nil %>
          
          </p></td></tr>    
          
         <% raw = File.read(Rails.root.join("public","uploads",User.by_username.key(GlobalProperty.find("signatory").value).first.signature)) rescue nil %>        
          <% if raw
              @sig = Base64.encode64(raw)
             end %>
           <% if @sig.present? %>    
             
      	    <tr><td colspan="3" align="right" style="height: 50px;"><br/><br/>
      	        <img src ="data:image/png;base64,<%= @sig %>" width="120" height="50" style="padding-right: 20px; margin-right: 20px;" />
      	    </td></tr>      
            <% end %>
      </table>
     
    </div>  
</body>
</html>
